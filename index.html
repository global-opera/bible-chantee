<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Chantee - Worship Francais</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Merriweather', Georgia, serif;
            background: #000080;
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        h1 { font-family: 'Playfair Display', Georgia, serif; font-size: 2.5em; margin-bottom: 10px; color: #ffce00; }
        .subtitle { color: #aaa; font-size: 1.1em; }
        .stats {
            background: rgba(255,255,255,0.05);
            padding: 15px 25px;
            border-radius: 10px;
            margin: 20px auto;
            display: inline-block;
        }
        .search-container {
            margin: 25px auto;
            display: flex;
            gap: 10px;
            max-width: 600px;
            justify-content: center;
        }
        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #ffce00;
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1em;
            outline: none;
        }
        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .search-input:focus {
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 15px rgba(255, 206, 0, 0.3);
        }
        .search-btn {
            background: #ffce00;
            border: none;
            color: #000080;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }
        .search-btn:hover {
            background: #f0c040;
            transform: scale(1.05);
        }
        .search-results {
            margin: 20px auto;
            max-width: 800px;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            display: none;
        }
        .search-results.active {
            display: block;
        }
        .search-result-item {
            background: rgba(255,255,255,0.1);
            border-left: 3px solid #ffce00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .search-result-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        .result-reference {
            color: #ffce00;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .result-text {
            color: #e0e0e0;
            line-height: 1.6;
        }
        .result-highlight {
            background: #ffce00;
            color: #000080;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        .search-stats {
            color: #ffce00;
            text-align: center;
            padding: 10px;
            font-size: 0.95em;
        }
        .section-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.3em;
            color: #ffce00;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }
        .book {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid rgba(212, 175, 55, 0.5);
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .book:hover { 
            background: rgba(212, 175, 55, 0.4); 
            border-color: #ffce00;
            transform: translateY(-2px); 
        }
        .book.unavailable {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            opacity: 0.3;
            cursor: not-allowed;
        }
        .book.unavailable:hover { 
            transform: none; 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1);
        }
        .book.playing { 
            background: rgba(212, 175, 55, 0.6); 
            border-color: #ffce00;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }
        .book-num { font-size: 0.75em; color: #ddd; margin-bottom: 5px; }
        .book-name { font-size: 0.95em; font-weight: 500; }
        .player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffce00;
            padding: 25px 20px;
            display: none;
            border-top: 5px solid #000080;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            min-height: 200px;
        }
        .player-container.active {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .player-info { text-align: center; margin-bottom: 10px; }
        .player-title { font-family: 'Playfair Display', Georgia, serif; font-size: 1.2em; color: #000080; }
        .player-controls { display: flex; align-items: center; gap: 15px; justify-content: center; flex-wrap: wrap; }
        audio { width: 100%; max-width: 500px; }
        .nav-btn {
            background: #000080;
            border: none;
            color: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .nav-btn:hover { background: #2563eb; }
        .nav-btn:disabled { background: #444; cursor: not-allowed; }
        .chapter-select { padding: 8px; border-radius: 5px; background: #333; color: #fff; border: 1px solid #555; }
        
        /* Boutons Paroles et Bible */
        .lyrics-btn, .bible-btn {
            background: #000080;
            border: 2px solid #ffce00;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }
        .lyrics-btn:hover, .bible-btn:hover {
            background: #2563eb;
            border-color: #f0c040;
        }
        .lyrics-btn.active, .bible-btn.active {
            background: #ffce00;
            color: #000080;
        }
        .lyrics-btn svg, .bible-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Wrapper flex pour Paroles et Bible c√¥te √† c√¥te */
        .content-wrapper {
            display: none;
            gap: 15px;
            margin: 15px 10px 10px 10px;
            max-height: 350px;
        }
        .content-wrapper.active {
            display: flex;
        }

        /* Zone des paroles */
        .lyrics-container {
            display: none;
            flex: 1;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }
        .lyrics-container.active {
            display: block;
        }
        .lyrics-container::-webkit-scrollbar {
            width: 8px;
        }
        .lyrics-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .lyrics-container::-webkit-scrollbar-thumb {
            background: #ffce00;
            border-radius: 4px;
        }
        .lyrics-text {
            font-size: 0.95em;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #e0e0e0;
        }
        .lyrics-text .section-label {
            color: #ffce00;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        .no-lyrics {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }

        /* Sections de paroles synchronis√©es */
        .lyrics-section {
            margin-bottom: 25px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 3px solid rgba(255, 206, 0, 0.3);
            transition: all 0.5s ease;
        }
        .lyrics-section.active {
            background: rgba(255, 206, 0, 0.15);
            border-left: 5px solid #ffce00;
            box-shadow: 0 0 20px rgba(255, 206, 0, 0.3);
            transform: scale(1.02);
        }
        .lyrics-section .section-title {
            font-weight: bold;
            color: #ffce00;
            margin: 0 0 10px 0;
            font-size: 1em;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 206, 0, 0.2);
        }
        .lyrics-section .lyrics-line {
            margin: 5px 0;
            line-height: 1.8;
            font-size: 0.95em;
            color: #e0e0e0;
        }

        /* Zone du texte biblique */
        .bible-container {
            display: none;
            flex: 1;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }
        .bible-container.active {
            display: block;
        }
        .bible-container::-webkit-scrollbar {
            width: 8px;
        }
        .bible-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .bible-container::-webkit-scrollbar-thumb {
            background: #ffce00;
            border-radius: 4px;
        }
        .bible-text {
            font-size: 0.95em;
            line-height: 1.8;
            color: #e0e0e0;
        }
        .verse {
            margin-bottom: 10px;
        }
        .verse-number {
            color: #ffce00;
            font-weight: bold;
            margin-right: 5px;
        }
        .no-bible {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: #666;
            font-size: 0.85em;
            margin-bottom: 180px;
        }
        footer a { color: #ffce00; text-decoration: none; }
        
        /* Mobile */
        @media (max-width: 600px) {
            .books-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            .book { padding: 10px 5px; }
            .book-name { font-size: 0.85em; }
            h1 { font-size: 1.8em; }
            footer { margin-bottom: 250px; }
            .content-wrapper {
                flex-direction: column;
                max-height: none;
            }
            .lyrics-container, .bible-container {
                max-height: 200px;
            }
            .player-title { font-size: 1.1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bible Chantee</h1>
            <p class="subtitle">La Parole de Dieu en musique worship francaise</p>
            <div class="stats">
                <span id="available-count">39</span> livres disponibles sur 66 |
                <span id="chapters-count">850</span> chapitres
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Rechercher un mot dans la Bible...">
                <button class="search-btn" onclick="searchBible()">üîç Rechercher</button>
            </div>
            <div class="search-results" id="searchResults"></div>
        </header>
        <h2 class="section-title">Ancien Testament</h2>
        <div class="books-grid" id="old-testament"></div>
        <h2 class="section-title">Nouveau Testament</h2>
        <div class="books-grid" id="new-testament"></div>
        <footer>
            <p>&copy; 2025 Bible Chant√©e - St√©phane Cassani - Tous droits d'auteur r√©serv√©s</p>
        </footer>
    </div>
    <div class="player-container" id="player">
        <div class="player-info">
            <span class="player-title" id="player-title">-</span>
        </div>
        <div class="player-controls">
            <button class="nav-btn" id="prev-btn">Precedent</button>
            <select class="chapter-select" id="chapter-select"></select>
            <button class="nav-btn" id="next-btn">Suivant</button>
            <button class="lyrics-btn" id="lyricsBtn" onclick="toggleLyrics()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="8" y1="13" x2="16" y2="13"></line>
                    <line x1="8" y1="17" x2="16" y2="17"></line>
                </svg>
                Paroles
            </button>
            <button class="bible-btn" id="bibleBtn" onclick="toggleBible()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                Bible
            </button>
        </div>
        <div class="player-controls" style="margin-top: 10px;">
            <audio id="audio" controls></audio>
        </div>
        <div class="content-wrapper" id="contentWrapper">
            <div class="lyrics-container" id="lyricsContainer">
                <div class="lyrics-text" id="lyricsText"></div>
            </div>
            <div class="bible-container" id="bibleContainer">
                <div class="bible-text" id="bibleText"></div>
            </div>
        </div>
    </div>
    
    <!-- Donnees des paroles et de la Bible -->
    <script src="lyrics-data.js"></script>
    <script src="audio-urls.js"></script>
    <script src="chapter-titles.js"></script>
    <script src="bible-data.js"></script>
    <script src="lyrics-timestamps.js"></script>

    <script>
        const driveMapping = {
            "01_Genese_05": "16wN91aTu8ogswvVBwLd0blDh2WA2JE0T",
            "01_Genese_49": "1Y78TqUnLNiDVTul65GgeNU6gGVl-5XpW",
            "19_Psaumes_116": "1uNJWodDU7nWOJDDQcJ-gcBjRNOUKYOqR",
            "19_Psaumes_111": "1WerMxG8ejpx8_MPo-RBhHzr0ibAyy_gJ",
            "01_Genese_03": "1tsIDT5Gw3oxBiKm1zlCmcFIJlK3vNu_-",
            "01_Genese_45": "1PyvlBKvnlUGd3FknVHYxdij1-hZ4efEv",
            "19_Psaumes_121": "1nWTEdXM2ODBxXMfrdwSGjHckVqd6pWHH",
            "19_Psaumes_114": "1H-XupLEpcokzBXrs13ilpOhi90P_N4O2"
        };
        const fileNames = {
            "01": "Genese",
            "02": "Exode",
            "03": "Levitique",
            "04": "Nombres",
            "05": "Deuteronome",
            "06": "Josue",
            "07": "Juges",
            "19": "Psaumes"
        };
        const books = [
                { num: "01", name: "Genese", chapters: 50, available: true },
                { num: "02", name: "Exode", chapters: 40, available: true },
                { num: "03", name: "Levitique", chapters: 27, available: true },
                { num: "04", name: "Nombres", chapters: 26, available: true },
                { num: "05", name: "Deuteronome", chapters: 34, available: true },
                { num: "06", name: "Josue", chapters: 24, available: true },
                { num: "07", name: "Juges", chapters: 21, available: true },
                { num: "08", name: "Ruth", chapters: 4, available: true },
                { num: "09", name: "1 Samuel", chapters: 31, available: true },
                { num: "10", name: "2 Samuel", chapters: 24, available: true },
                { num: "11", name: "1 Rois", chapters: 22, available: true },
                { num: "12", name: "2 Rois", chapters: 25, available: true },
                { num: "13", name: "1 Chroniques", chapters: 29, available: true },
                { num: "14", name: "2 Chroniques", chapters: 36, available: true },
                { num: "15", name: "Esdras", chapters: 10, available: true },
                { num: "16", name: "Nehemie", chapters: 13, available: true },
                { num: "17", name: "Esther", chapters: 10, available: true },
                { num: "18", name: "Job", chapters: 42, available: true },
                { num: "19", name: "Psaumes", chapters: 150, available: true },
                { num: "20", name: "Proverbes", chapters: 31, available: true },
                { num: "21", name: "Ecclesiaste", chapters: 12, available: true },
                { num: "22", name: "Cantique", chapters: 8, available: true },
                { num: "23", name: "Esaie", chapters: 66, available: true },
                { num: "24", name: "Jeremie", chapters: 52, available: true },
                { num: "25", name: "Lamentations", chapters: 5, available: true },
                { num: "26", name: "Ezechiel", chapters: 48, available: true },
                { num: "27", name: "Daniel", chapters: 12, available: true },
                { num: "28", name: "Osee", chapters: 14, available: true },
                { num: "29", name: "Joel", chapters: 3, available: true },
                { num: "30", name: "Amos", chapters: 9, available: true },
                { num: "31", name: "Abdias", chapters: 1, available: true },
                { num: "32", name: "Jonas", chapters: 4, available: true },
                { num: "33", name: "Michee", chapters: 7, available: true },
                { num: "34", name: "Nahum", chapters: 3, available: true },
                { num: "35", name: "Habacuc", chapters: 3, available: true },
                { num: "36", name: "Sophonie", chapters: 3, available: true },
                { num: "37", name: "Aggee", chapters: 2, available: true },
                { num: "38", name: "Zacharie", chapters: 14, available: true },
                { num: "39", name: "Malachie", chapters: 4, available: true },
                { num: "40", name: "Matthieu", chapters: 28, available: true },
                { num: "41", name: "Marc", chapters: 16, available: true },
                { num: "42", name: "Luc", chapters: 24, available: true },
                { num: "43", name: "Jean", chapters: 21, available: true },
                { num: "44", name: "Actes", chapters: 28, available: true },
                { num: "45", name: "Romains", chapters: 16, available: true },
                { num: "46", name: "1 Corinthiens", chapters: 16, available: true },
                { num: "47", name: "2 Corinthiens", chapters: 13, available: true },
                { num: "48", name: "Galates", chapters: 6, available: true },
                { num: "49", name: "Ephesiens", chapters: 6, available: true },
                { num: "50", name: "Philippiens", chapters: 4, available: true },
                { num: "51", name: "Colossiens", chapters: 4, available: true },
                { num: "52", name: "1 Thessaloniciens", chapters: 5, available: true },
                { num: "53", name: "2 Thessaloniciens", chapters: 3, available: true },
                { num: "54", name: "1 Timothee", chapters: 6, available: true },
                { num: "55", name: "2 Timothee", chapters: 4, available: true },
                { num: "56", name: "Tite", chapters: 3, available: true },
                { num: "57", name: "Philemon", chapters: 1, available: true },
                { num: "58", name: "Hebreux", chapters: 13, available: true },
                { num: "59", name: "Jacques", chapters: 5, available: true },
                { num: "60", name: "1 Pierre", chapters: 5, available: true },
                { num: "61", name: "2 Pierre", chapters: 3, available: true },
                { num: "62", name: "1 Jean", chapters: 5, available: true },
                { num: "63", name: "2 Jean", chapters: 1, available: true },
                { num: "64", name: "3 Jean", chapters: 1, available: true },
                { num: "65", name: "Jude", chapters: 1, available: true },
                { num: "66", name: "Apocalypse", chapters: 22, available: true },
        ];
        const oldTestament = books.filter(b => parseInt(b.num) <= 39);
        const newTestament = books.filter(b => parseInt(b.num) > 39);
        let currentBook = null;
        let currentChapter = 1;
        let lyricsVisible = false;
        let bibleVisible = false;

        // Update stats dynamically
        const availableBooks = books.filter(b => b.available);
        const totalChapters = availableBooks.reduce((sum, b) => sum + b.chapters, 0);
        document.getElementById('available-count').textContent = availableBooks.length;
        document.getElementById('chapters-count').textContent = totalChapters;

        function renderBooks(container, bookList) {
            const el = document.getElementById(container);
            el.innerHTML = bookList.map(book =>
                '<div class="book'+(book.available ? '' : ' unavailable')+'" data-num="'+book.num+'" data-chapters="'+book.chapters+'" data-available="'+book.available+'">' +
                '<div class="book-num">'+book.num+'</div>' +
                '<div class="book-name">'+book.name+'</div></div>'
            ).join('');
        }

        function searchBible() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            const searchTerm = searchInput.value.trim().toLowerCase();

            if (!searchTerm || searchTerm.length < 3) {
                alert('Veuillez entrer au moins 3 caract√®res pour la recherche');
                return;
            }

            if (typeof bibleData === 'undefined') {
                alert('Donn√©es bibliques non charg√©es');
                return;
            }

            // Recherche dans toute la Bible
            let results = [];
            let totalMatches = 0;

            for (let bookNum in bibleData) {
                const book = books.find(b => b.num === bookNum);
                if (!book) continue;

                for (let chapter in bibleData[bookNum]) {
                    const verses = bibleData[bookNum][chapter];
                    verses.forEach(verse => {
                        const verseText = verse.text.toLowerCase();
                        if (verseText.includes(searchTerm)) {
                            results.push({
                                bookNum: bookNum,
                                bookName: book.name,
                                chapter: parseInt(chapter),
                                verseNum: verse.num,
                                text: verse.text,
                                available: book.available
                            });
                            totalMatches++;
                        }
                    });
                }
            }

            // Limiter les r√©sultats √† 50 pour performance
            results = results.slice(0, 50);

            // Afficher les r√©sultats
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-stats">Aucun r√©sultat trouv√© pour "' + searchTerm + '"</div>';
                searchResults.classList.add('active');
                return;
            }

            let html = '<div class="search-stats">' + totalMatches + ' verset(s) trouv√©(s) pour "' + searchTerm + '"';
            if (totalMatches > 50) html += ' (affichage des 50 premiers)';
            html += '</div>';

            results.forEach(result => {
                // Highlight du terme recherch√©
                const regex = new RegExp('(' + searchTerm + ')', 'gi');
                const highlightedText = result.text.replace(regex, '<span class="result-highlight">$1</span>');

                const onclick = result.available
                    ? 'onclick="searchResultClick(\'' + result.bookNum + '\', ' + result.chapter + ')"'
                    : '';

                const availableClass = result.available ? '' : ' style="opacity: 0.5; cursor: not-allowed;"';

                html += '<div class="search-result-item" ' + onclick + availableClass + '>';
                html += '<div class="result-reference">' + result.bookName + ' ' + result.chapter + ':' + result.verseNum;
                if (!result.available) html += ' (non disponible)';
                html += '</div>';
                html += '<div class="result-text">' + highlightedText + '</div>';
                html += '</div>';
            });

            searchResults.innerHTML = html;
            searchResults.classList.add('active');
        }

        function searchResultClick(bookNum, chapter) {
            const book = books.find(b => b.num === bookNum);
            if (!book || !book.available) return;

            // Ouvrir le livre et jouer le chapitre
            playBook(bookNum, book.chapters);
            // Petit d√©lai pour que le lecteur s'initialise
            setTimeout(() => {
                playChapter(chapter);
            }, 100);

            // Scroll vers le lecteur
            document.getElementById('player').scrollIntoView({ behavior: 'smooth' });

            // Fermer les r√©sultats de recherche
            document.getElementById('searchResults').classList.remove('active');
        }

        // Recherche en appuyant sur Entr√©e
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchBible();
                }
            });
        });
        
        function toggleLyrics() {
            lyricsVisible = !lyricsVisible;
            const lyricsContainer = document.getElementById('lyricsContainer');
            const lyricsBtn = document.getElementById('lyricsBtn');
            const contentWrapper = document.getElementById('contentWrapper');

            if (lyricsVisible) {
                lyricsContainer.classList.add('active');
                lyricsBtn.classList.add('active');
            } else {
                lyricsContainer.classList.remove('active');
                lyricsBtn.classList.remove('active');
            }

            // Afficher le wrapper si au moins un container est actif
            if (lyricsVisible || bibleVisible) {
                contentWrapper.classList.add('active');
            } else {
                contentWrapper.classList.remove('active');
            }
        }

        function toggleBible() {
            bibleVisible = !bibleVisible;
            const bibleContainer = document.getElementById('bibleContainer');
            const bibleBtn = document.getElementById('bibleBtn');
            const contentWrapper = document.getElementById('contentWrapper');

            if (bibleVisible) {
                bibleContainer.classList.add('active');
                bibleBtn.classList.add('active');
            } else {
                bibleContainer.classList.remove('active');
                bibleBtn.classList.remove('active');
            }

            // Afficher le wrapper si au moins un container est actif
            if (lyricsVisible || bibleVisible) {
                contentWrapper.classList.add('active');
            } else {
                contentWrapper.classList.remove('active');
            }
        }
        
        let lastActiveSection = -1;

        function updateLyrics() {
            const lyricsText = document.getElementById('lyricsText');
            const lyricsContainer = document.getElementById('lyricsContainer');

            // Utiliser les timestamps si disponibles
            if (typeof lyricsTimestamps !== 'undefined' && lyricsTimestamps[currentBook] && lyricsTimestamps[currentBook][currentChapter]) {
                const sections = lyricsTimestamps[currentBook][currentChapter];
                lyricsText.innerHTML = '';

                sections.forEach((section, index) => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'lyrics-section';
                    sectionDiv.id = 'lyrics-section-' + index;
                    sectionDiv.dataset.start = section.start;

                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'section-title';
                    titleDiv.textContent = section.type;
                    sectionDiv.appendChild(titleDiv);

                    section.lines.forEach(line => {
                        const lineDiv = document.createElement('div');
                        lineDiv.className = 'lyrics-line';
                        lineDiv.textContent = line;
                        sectionDiv.appendChild(lineDiv);
                    });

                    lyricsText.appendChild(sectionDiv);
                });

                lastActiveSection = -1;
            } else if (typeof chapterLyrics !== 'undefined' && chapterLyrics[currentBook] && chapterLyrics[currentBook][currentChapter]) {
                let lyrics = chapterLyrics[currentBook][currentChapter];
                lyrics = lyrics.replace(/\[([^\]]+)\]/g, '<span class="section-label">[$1]</span>');
                lyricsText.innerHTML = lyrics;
            } else {
                lyricsText.innerHTML = '<div class="no-lyrics">Paroles non disponibles pour ce chapitre</div>';
            }

            lyricsContainer.scrollTop = 0;
        }

        function updateBible() {
            const bibleText = document.getElementById('bibleText');
            const bibleContainer = document.getElementById('bibleContainer');

            if (typeof bibleData !== 'undefined' && bibleData[currentBook] && bibleData[currentBook][currentChapter]) {
                const verses = bibleData[currentBook][currentChapter];
                let html = '';
                verses.forEach(verse => {
                    html += '<div class="verse"><span class="verse-number">' + verse.num + '.</span>' + verse.text + '</div>';
                });
                bibleText.innerHTML = html;
            } else {
                bibleText.innerHTML = '<div class="no-bible">Texte biblique non disponible pour ce chapitre</div>';
            }
            // Scroll en haut
            bibleContainer.scrollTop = 0;
        }
        
        function playBook(num, chapters) {
            currentBook = num;
            currentChapter = 1;
            document.querySelectorAll('.book').forEach(b => b.classList.remove('playing'));
            document.querySelector('.book[data-num="'+num+'"]').classList.add('playing');
            const select = document.getElementById('chapter-select');
            select.innerHTML = '';
            for (let i = 1; i <= chapters; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = 'Chapitre ' + i;
                select.appendChild(opt);
            }
            document.getElementById('player').classList.add('active');
            playChapter(1);
        }
        
        function playChapter(chapter) {
            currentChapter = chapter;
            // Utiliser URLs Suno CDN depuis audio-urls.js
            const url = audioUrls[currentBook] && audioUrls[currentBook][chapter];
            if (!url) {
                console.error("URL non trouvee pour:", currentBook, chapter);
                return;
            }
            const audio = document.getElementById('audio');
            audio.src = url;
            audio.play().catch(err => console.error("Erreur lecture:", url, err));
            const book = books.find(b => b.num === currentBook);
            // Construire le titre avec le titre du chapitre
            let displayTitle = book.name + ' - Ch.' + String(chapter).padStart(2, '0');
            // Ajouter le titre du chapitre depuis chapterTitles
            if (chapterTitles && chapterTitles[currentBook] && chapterTitles[currentBook][chapter]) {
                displayTitle += ' - ' + chapterTitles[currentBook][chapter];
            }
            document.getElementById('player-title').textContent = displayTitle;
            document.getElementById('chapter-select').value = chapter;
            document.getElementById('prev-btn').disabled = chapter <= 1;
            document.getElementById('next-btn').disabled = chapter >= book.chapters;

            // Activer automatiquement les paroles
            if (!lyricsVisible) {
                toggleLyrics();
            }

            // Mettre a jour les paroles et la Bible
            updateLyrics();
            updateBible();
        }
        
        document.addEventListener('click', e => {
            const book = e.target.closest('.book');
            if (book && book.dataset.available === 'true') {
                playBook(book.dataset.num, parseInt(book.dataset.chapters));
            }
        });
        document.getElementById('chapter-select').addEventListener('change', e => {
            playChapter(parseInt(e.target.value));
        });
        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentChapter > 1) playChapter(currentChapter - 1);
        });
        document.getElementById('next-btn').addEventListener('click', () => {
            const book = books.find(b => b.num === currentBook);
            if (currentChapter < book.chapters) playChapter(currentChapter + 1);
        });
        document.getElementById('audio').addEventListener('ended', () => {
            const book = books.find(b => b.num === currentBook);
            if (currentChapter < book.chapters) playChapter(currentChapter + 1);
        });

        // AUTO-SCROLL des paroles synchronis√©es
        document.getElementById('audio').addEventListener('timeupdate', function() {
            if (typeof lyricsTimestamps === 'undefined' || !lyricsTimestamps[currentBook] || !lyricsTimestamps[currentBook][currentChapter]) {
                return;
            }

            const sections = lyricsTimestamps[currentBook][currentChapter];
            const currentTime = this.currentTime;
            let activeIndex = 0;

            // Trouver la section active avec buffer de 2 secondes
            for (let i = sections.length - 1; i >= 0; i--) {
                if (currentTime >= sections[i].start + 2.0) {
                    activeIndex = i;
                    break;
                }
            }

            // Mettre √† jour seulement si la section a chang√©
            if (activeIndex !== lastActiveSection) {
                // Retirer le highlight de toutes les sections
                document.querySelectorAll('.lyrics-section').forEach(s => s.classList.remove('active'));

                // Ajouter le highlight √† la section active
                const activeSection = document.getElementById('lyrics-section-' + activeIndex);
                if (activeSection) {
                    activeSection.classList.add('active');

                    // Scroll automatique vers la section active
                    const lyricsContainer = document.getElementById('lyricsContainer');
                    const containerTop = lyricsContainer.scrollTop;
                    const containerBottom = containerTop + lyricsContainer.clientHeight;
                    const sectionTop = activeSection.offsetTop;
                    const sectionBottom = sectionTop + activeSection.offsetHeight;

                    // Centrer la section active dans le container
                    if (sectionTop < containerTop || sectionBottom > containerBottom) {
                        lyricsContainer.scrollTop = sectionTop - lyricsContainer.clientHeight / 2 + activeSection.offsetHeight / 2;
                    }
                }

                lastActiveSection = activeIndex;
            }
        });

        renderBooks('old-testament', oldTestament);
        renderBooks('new-testament', newTestament);
    </script>
</body>
</html>
